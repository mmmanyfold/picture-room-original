[supervisord]
environment=LANG="en_US.utf8", LC_ALL="en_US.UTF-8", LC_LANG="en_US.UTF-8"

[program:gunicorn]
command=sudo -u <%= @user %> <%= @app_root %>/env/bin/gunicorn -c <%= @gunicorn_path %> <%= @wsgi_path %>
directory=<%= @app_root %>/src/
autostart=true
autorestart=true

[program:flower]
command=<%= @app_root %>/env/bin/celery -A ov_api flower
directory=<%= @app_root %>/src/
user=<%= @user %>
autostart=true
autorestart=true

[program:dash]
command=/home/<%= @user %>/linux-dash/server/server -listen="0.0.0.0:5556"
directory=/home/<%= @user %>/linux-dash/server
user=<%= @user %>
autostart=true
autorestart=true

[program:celery]
; Set full path to celery program if using virtualenv
command=<%= @app_root %>/env/bin/celery worker -A ov_api -P eventlet --autoscale=3,1 -n worker.%%h -Q celery,shopify --loglevel=INFO

directory=<%= @app_root %>/src
user=<%= @user %>
numprocs=1
stdout_logfile=/var/log/celery/worker.log
stderr_logfile=/var/log/celery/worker.log
autostart=true
autorestart=true
startsecs=10

; Need to wait for currently executing tasks to finish at shutdown.
; Increase this if you have very long running tasks.
stopwaitsecs = 600

; When resorting to send SIGKILL to the program to terminate it
; send SIGKILL to its whole process group instead,
; taking care of its children as well.
killasgroup=true

; if rabbitmq is supervised, set its priority higher
; so it starts first
priority=998

[program:celery_quiet]
; Set full path to celery program if using virtualenv
command=<%= @app_root %>/env/bin/celery worker -A ov_api -P eventlet --autoscale=3,1 -n quiet-worker.%%h -Q quiet --loglevel=INFO

directory=<%= @app_root %>/src
user=<%= @user %>
numprocs=1
stdout_logfile=/var/log/celery/quiet_worker.log
stderr_logfile=/var/log/celery/quiet_worker.log
autostart=true
autorestart=true
startsecs=10

; Need to wait for currently executing tasks to finish at shutdown.
; Increase this if you have very long running tasks.
stopwaitsecs = 600

; When resorting to send SIGKILL to the program to terminate it
; send SIGKILL to its whole process group instead,
; taking care of its children as well.
killasgroup=true

; if rabbitmq is supervised, set its priority higher
; so it starts first
priority=998

[program:celerybeat]
; Set full path to celery program if using virtualenv
command=<%= @app_root %>/env/bin/celery -A ov_api beat
directory=<%= @app_root %>/src
user=<%= @user %>
autostart=true
autorestart=true